from base64 import b64encode
from io import BytesIO
from typing import Optional

import qrcode
from fastapi import FastAPI
from fastapi.responses import HTMLResponse
from pydantic import BaseModel


class CreateQRCodeResponse(BaseModel):
    """
    Response model for the QR code creation operation, including the URL of the generated QR code.
    """

    qr_code_url: str
    qr_code_data: Optional[str] = None


app = FastAPI()


@app.get(
    "/create_qr_code/", response_model=CreateQRCodeResponse, response_class=HTMLResponse
)
def create_qr_code(
    color: str = "#8A2BE2",
    size: str = "500x500",
    format: str = "SVG",
    error_correction: str = "H",
    data: str = "https://www.technewsreview.com",
) -> CreateQRCodeResponse:
    """
    Generates a new QR code with the specified parameters.

    Args:
        color (str): HEX color code for the QR code, defaults to violet.
        size (str): Size of the QR code in pixels. Format is width x height, defaulting to 500x500.
        format (str): The desired file format for the QR code, e.g., SVG or PNG.
        error_correction (str): Error correction level for the QR code, options: L, M, Q, H. Default is H.
        data (str): Data to be encoded within the QR code, such as a URL or text.

    Returns:
        CreateQRCodeResponse: Response model for the QR code creation operation, including the URL of the generated QR code.
    """
    error_correction_map = {
        "L": qrcode.constants.ERROR_CORRECT_L,
        "M": qrcode.constants.ERROR_CORRECT_M,
        "Q": qrcode.constants.ERROR_CORRECT_Q,
        "H": qrcode.constants.ERROR_CORRECT_H,
    }  # TODO(autogpt): "constants" is not a known member of module "qrcode". reportAttributeAccessIssue
    #   {'metadata': 'Metadata-Version: 2.1\nName: qrcode\nVersion: 7.3.1\nSummary: QR Code image generator\nHome-page: https://github.com/lincolnloop/python-qrcode\nAuthor: Lincoln Loop\nAuthor-email: info@lincolnloop.com\nLicense: BSD\nKeywords: qr denso-wave IEC18004\nClassifier: Development Status :: 5 - Production/Stable\nClassifier: License :: OSI Approved :: BSD License\nClassifier: Operating System :: OS Independent\nClassifier: Intended Audience :: Developers\nClassifier: Programming Language :: Python\nClassifier: Programming Language :: Python :: 3\nClassifier: Programming Language :: Python :: 3.6\nClassifier: Programming Language :: Python :: 3.7\nClassifier: Programming Language :: Python :: 3.8\nClassifier: Programming Language :: Python :: 3.9\nClassifier: Programming Language :: Python :: 3.10\nClassifier: Programming Language :: Python :: 3 :: Only\nClassifier: Topic :: Multimedia :: Graphics\nClassifier: Topic :: Software Development :: Libraries :: Python Modules\nRequires-Python: >=3.6\nLicense-File: LICENSE\nRequires-Dist: colorama ; platform_system == "Windows"\nProvides-Extra: all\nRequires-Dist: zest.releaser[recommended] ; extra == \'all\'\nRequires-Dist: tox ; extra == \'all\'\nRequires-Dist: pytest ; extra == \'all\'\nRequires-Dist: pytest-cov ; extra == \'all\'\nRequires-Dist: pillow ; extra == \'all\'\nProvides-Extra: dev\nRequires-Dist: tox ; extra == \'dev\'\nRequires-Dist: pytest ; extra == \'dev\'\nProvides-Extra: maintainer\nRequires-Dist: zest.releaser[recommended] ; extra == \'maintainer\'\nProvides-Extra: pil\nRequires-Dist: pillow ; extra == \'pil\'\nProvides-Extra: test\nRequires-Dist: pytest ; extra == \'test\'\nRequires-Dist: pytest-cov ; extra == \'test\'\n\n=============================\nPure python QR Code generator\n=============================\n\nGenerate QR codes.\n\nFor a standard install (which will include pillow_ for generating images),\nrun::\n\n    pip install qrcode[pil]\n\n.. _pillow: https://pypi.python.org/pypi/Pillow\n\n\nWhat is a QR Code?\n==================\n\nA Quick Response code is a two-dimensional pictographic code used for its fast\nreadability and comparatively large storage capacity. The code consists of\nblack modules arranged in a square pattern on a white background. The\ninformation encoded can be made up of any kind of data (e.g., binary,\nalphanumeric, or Kanji symbols)\n\nUsage\n=====\n\nFrom the command line, use the installed ``qr`` script::\n\n    qr "Some text" > test.png\n\nOr in Python, use the ``make`` shortcut function:\n\n.. code:: python\n\n    import qrcode\n    img = qrcode.make(\'Some data here\')\n    type(img)  # qrcode.image.pil.PilImage\n    img.save("some_file.png")\n\nAdvanced Usage\n--------------\n\nFor more control, use the ``QRCode`` class. For example:\n\n.. code:: python\n\n    import qrcode\n    qr = qrcode.QRCode(\n        version=1,\n        error_correction=qrcode.constants.ERROR_CORRECT_L,\n        box_size=10,\n        border=4,\n    )\n    qr.add_data(\'Some data\')\n    qr.make(fit=True)\n\n    img = qr.make_image(fill_color="black", back_color="white")\n\nThe ``version`` parameter is an integer from 1 to 40 that controls the size of\nthe QR Code (the smallest, version 1, is a 21x21 matrix).\nSet to ``None`` and use the ``fit`` parameter when making the code to determine\nthis automatically.\n\n``fill_color`` and ``back_color`` can change the background and the painting\ncolor of the QR, when using the default image factory. Both parameters accept\nRGB color tuples.\n\n.. code:: python\n\n\n    img = qr.make_image(back_color=(255, 195, 235), fill_color=(55, 95, 35))\n\nThe ``error_correction`` parameter controls the error correction used for the\nQR Code. The following four constants are made available on the ``qrcode``\npackage:\n\n``ERROR_CORRECT_L``\n    About 7% or less errors can be corrected.\n``ERROR_CORRECT_M`` (default)\n    About 15% or less errors can be corrected.\n``ERROR_CORRECT_Q``\n    About 25% or less errors can be corrected.\n``ERROR_CORRECT_H``.\n    About 30% or less errors can be corrected.\n\nThe ``box_size`` parameter controls how many pixels each "box" of the QR code\nis.\n\nThe ``border`` parameter controls how many boxes thick the border should be\n(the default is 4, which is the minimum according to the specs).\n\nOther image factories\n=====================\n\nYou can encode as SVG, or use a new pure Python image processor to encode to\nPNG images.\n\nThe Python examples below use the ``make`` shortcut. The same ``image_factory``\nkeyword argument is a valid option for the ``QRCode`` class for more advanced\nusage.\n\nSVG\n---\n\nYou can create the entire SVG or an SVG fragment. When building an entire SVG\nimage, you can use the factory that combines as a path (recommended, and\ndefault for the script) or a factory that creates a simple set of rectangles.\n\nFrom your command line::\n\n    qr --factory=svg-path "Some text" > test.svg\n    qr --factory=svg "Some text" > test.svg\n    qr --factory=svg-fragment "Some text" > test.svg\n\nOr in Python:\n\n.. code:: python\n\n    import qrcode\n    import qrcode.image.svg\n\n    if method == \'basic\':\n        # Simple factory, just a set of rects.\n        factory = qrcode.image.svg.SvgImage\n    elif method == \'fragment\':\n        # Fragment factory (also just a set of rects)\n        factory = qrcode.image.svg.SvgFragmentImage\n    else:\n        # Combined path factory, fixes white space that may occur when zooming\n        factory = qrcode.image.svg.SvgPathImage\n\n    img = qrcode.make(\'Some data here\', image_factory=factory)\n\nTwo other related factories are available that work the same, but also fill the\nbackground of the SVG with white::\n\n    qrcode.image.svg.SvgFillImage\n    qrcode.image.svg.SvgPathFillImage\n\n\nPure Python PNG\n---------------\n\nInstall the following two packages::\n\n    pip install -e git+git://github.com/ojii/pymaging.git#egg=pymaging\n    pip install -e git+git://github.com/ojii/pymaging-png.git#egg=pymaging-png\n\nFrom your command line::\n\n    qr --factory=pymaging "Some text" > test.png\n\nOr in Python:\n\n.. code:: python\n\n    import qrcode\n    from qrcode.image.pure import PymagingImage\n    img = qrcode.make(\'Some data here\', image_factory=PymagingImage)\n\n\nStyled Image\n------------\nTo apply styles to the QRCode, use the StyledPilImage image factory. \nThis takes an optional module drawer to control the shape of the QR Code, an \noptional color mask to change the colors of the QR Code, and an optional image \nto embed in the center.\n\nThese QR Codes are not guaranteed to work with all readers, so do some \nexperimentation and set the error correction to high (especially if embedding an \nimage).\n\nExamples to draw the QR code with rounded corners, radial gradiant and embedded image:\n\n.. code:: python\n\n    import qrcode\n    from qrcode.image.styledpil import StyledPilImage\n    from qrcode.image.styles.moduledrawers import RoundedModuleDrawer\n    from qrcode.image.styles.colormasks import RadialGradiantColorMask\n\n    qr = qrcode.QRCode(error_correction=qrcode.constants.ERROR_CORRECT_L)\n    qr.add_data(\'Some data\')\n\n    img_1 = qr.make_image(image_factory=StyledPilImage, module_drawer=RoundedModuleDrawer())\n    img_2 = qr.make_image(image_factory=StyledPilImage, color_mask=RadialGradiantColorMask())\n    img_3 = qr.make_image(image_factory=StyledPilImage, embeded_image_path="/path/to/image.png")\n\nOther module_drawers:\n\n    .. image:: doc/module_drawers.png\n\nOther color masks:\n\n    .. image:: doc/color_masks.png\n\nExamples\n========\n\nGet the text content from `print_ascii`:\n\n.. code:: python\n\n    import io\n    import qrcode\n    qr = qrcode.QRCode()\n    qr.add_data("Some text")\n    f = io.StringIO()\n    qr.print_ascii(out=f)\n    f.seek(0)\n    print(f.read())\n\nThe `add_data` method will append data to the current QR object. To add new data by replacing previous content in the same object, first use clear method:\n\n.. code:: python\n\n    import qrcode\n    qr = qrcode.QRCode()\n    qr.add_data(\'Some data\')\n    img = qr.make_image()\n    qr.clear()\n    qr.add_data(\'New data\')\n    other_img = qr.make_image()\n\nPipe ascii output to text file in command line::\n\n    qr --ascii "Some data" > "test.txt"\n    cat test.txt\n\nAlternative to piping output to file to avoid PoweShell issues::\n\n    # qr "Some data" > test.png\n    qr --output=test.png "Some data"\n\n==========\nChange log\n==========\n\n7.3.1 (1 October 2021)\n======================\n\n- Improvements for embeded image.\n\n\n7.3 (19 August 2021)\n====================\n\n- Skip color mask if QR is black and white\n\n\n7.2 (19 July 2021)\n==================\n\n- Add Styled PIL image factory, allowing different color masks and shapes in QR codes\n\n- Small performance inprovement\n\n- Add check for border size parameter\n\n\n7.1 (1 July 2021)\n=================\n\n- Add --ascii parameter to command line interface allowing to output ascii when stdout is piped\n\n- Add --output parameter to command line interface to specify output file\n\n- Accept RGB tuples in fill_color and back_color\n\n- Add to_string method to SVG images\n\n- Replace inline styles with SVG attributes to avoid CSP issues\n\n- Add Python3.10 to supported versions\n\n\n7.0 (29 June 2021)\n==================\n\n- Drop Python < 3.6 support.\n\n\n6.1 (14 January 2019)\n=====================\n\n- Fix short chunks of data not being optimized to the correct mode.\n\n- Tests fixed for Python 3\n\n\n6.0 (23 March 2018)\n===================\n\n- Fix optimize length being ignored in ``QRCode.add_data``.\n\n- Better calculation of the best mask pattern and related optimizations. Big\n  thanks to cryptogun!\n\n\n5.3 (18 May 2016)\n=================\n\n* Fix incomplete block table for QR version 15. Thanks Rodrigo Queiro for the\n  report and Jacob Welsh for the investigation and fix.\n\n* Avoid unnecessary dependency for non MS platforms, thanks to Noah Vesely.\n\n* Make ``BaseImage.get_image()`` actually work.\n\n\n5.2 (25 Jan 2016)\n=================\n\n* Add ``--error-correction`` option to qr script.\n\n* Fix script piping to stdout in Python 3 and reading non-UTF-8 characters in\n  Python 3.\n\n* Fix script piping in Windows.\n\n* Add some useful behind-the-curtain methods for tinkerers.\n\n* Fix terminal output when using Python 2.6\n\n* Fix terminal output to display correctly on MS command line.\n\n5.2.1\n-----\n\n* Small fix to terminal output in Python 3 (and fix tests)\n\n5.2.2\n-----\n\n* Revert some terminal changes from 5.2 that broke Python 3\'s real life tty\n  code generation and introduce a better way from Jacob Welsh.\n\n\n5.1 (22 Oct 2014)\n=================\n\n* Make ``qr`` script work in Windows. Thanks Ionel Cristian Mărieș\n\n* Fixed print_ascii function in Python 3.\n\n* Out-of-bounds code version numbers are handled more consistently with a\n  ValueError.\n\n* Much better test coverage (now only officially supporting Python 2.6+)\n\n\n5.0 (17 Jun 2014)\n=================\n\n* Speed optimizations.\n\n* Change the output when using the ``qr`` script to use ASCII rather than\n  just colors, better using the terminal real estate.\n\n* Fix a bug in passing bytecode data directly when in Python 3.\n\n* Substation speed optimizations to best-fit algorithm (thanks Jacob Welsh!).\n\n* Introduce a ``print_ascii`` method and use it as the default for the ``qr``\n  script rather than ``print_tty``.\n\n5.0.1\n-----\n\n* Update version numbers correctly.\n\n\n4.0 (4 Sep 2013)\n================\n\n* Made qrcode work on Python 2.4 - Thanks tcely.\n  Note: officially, qrcode only supports 2.5+.\n\n* Support pure-python PNG generation (via pymaging) for Python 2.6+ -- thanks\n  Adam Wisniewski!\n\n* SVG image generation now supports alternate sizing (the default box size of\n  10 == 1mm per rectangle).\n\n* SVG path image generation allows cleaner SVG output by combining all QR rects\n  into a single path. Thank you, Viktor Stískala.\n\n* Added some extra simple SVG factories that fill the background white.\n\n4.0.1\n-----\n\n* Fix the pymaging backend not able to save the image to a buffer. Thanks ilj!\n\n4.0.2\n-----\n\n* Fix incorrect regex causing a comma to be considered part of the alphanumeric\n  set.\n\n* Switch to using setuptools for setup.py.\n\n4.0.3\n-----\n\n* Fix bad QR code generation due to the regex comma fix in version 4.0.2.\n\n4.0.4\n-----\n\n* Bad version number for previous hotfix release.\n\n\n3.1 (12 Aug 2013)\n=================\n\n* Important fixes for incorrect matches of the alpha-numeric encoding mode.\n  Previously, the pattern would match if a single line was alpha-numeric only\n  (even if others wern\'t). Also, the two characters ``{`` and ``}`` had snuck\n  in as valid characters. Thanks to Eran Tromer for the report and fix.\n\n* Optimized chunking -- if the parts of the data stream can be encoded more\n  efficiently, the data will be split into chunks of the most efficient modes.\n\n3.1.1\n-----\n\n* Update change log to contain version 3.1 changes. :P\n\n* Give the ``qr`` script an ``--optimize`` argument to control the chunk\n  optimization setting.\n\n\n3.0 (25 Jun 2013)\n=================\n\n* Python 3 support.\n\n* Add QRCode.get_matrix, an easy way to get the matrix array of a QR code\n  including the border. Thanks Hugh Rawlinson.\n\n* Add in a workaround so that Python 2.6 users can use SVG generation (they\n  must install ``lxml``).\n\n* Some initial tests! And tox support (``pip install tox``) for testing across\n  Python platforms.\n\n\n2.7 (5 Mar 2013)\n================\n\n* Fix incorrect termination padding.\n\n\n2.6 (2 Apr 2013)\n================\n\n* Fix the first four columns incorrectly shifted by one. Thanks to Josep\n  Gómez-Suay for the report and fix.\n\n* Fix strings within 4 bits of the QR version limit being incorrectly\n  terminated. Thanks to zhjie231 for the report.\n\n\n2.5 (12 Mar 2013)\n=================\n\n* The PilImage wrapper is more transparent - you can use any methods or\n  attributes available to the underlying PIL Image instance.\n\n* Fixed the first column of the QR Code coming up empty! Thanks to BecoKo.\n\n2.5.1\n-----\n\n* Fix installation error on Windows.\n\n\n2.4 (23 Apr 2012)\n=================\n\n* Use a pluggable backend system for generating images, thanks to Branko Čibej!\n  Comes with PIL and SVG backends built in.\n\n2.4.1\n-----\n\n* Fix a packaging issue\n\n2.4.2\n-----\n\n* Added a ``show`` method to the PIL image wrapper so the ``run_example``\n  function actually works.\n\n\n2.3 (29 Jan 2012)\n=================\n\n* When adding data, auto-select the more efficient encoding methods for numbers\n  and alphanumeric data (KANJI still not supported).\n\n2.3.1\n-----\n\n* Encode unicode to utf-8 bytestrings when adding data to a QRCode.\n\n\n2.2 (18 Jan 2012)\n=================\n\n* Fixed tty output to work on both white and black backgrounds.\n\n* Added `border` parameter to allow customizing of the number of boxes used to\n  create the border of the QR code\n\n\n2.1 (17 Jan 2012)\n=================\n\n* Added a ``qr`` script which can be used to output a qr code to the tty using\n  background colors, or to a file via a pipe.\n', 'context': None}
    qr = qrcode.QRCode(
        version=1,
        error_correction=error_correction_map.get(
            error_correction, qrcode.constants.ERROR_CORRECT_H
        ),
        box_size=10,
        border=4,
    )  # TODO(autogpt): "QRCode" is not a known member of module "qrcode". reportAttributeAccessIssue
    #   {'metadata': 'Metadata-Version: 2.1\nName: qrcode\nVersion: 7.3.1\nSummary: QR Code image generator\nHome-page: https://github.com/lincolnloop/python-qrcode\nAuthor: Lincoln Loop\nAuthor-email: info@lincolnloop.com\nLicense: BSD\nKeywords: qr denso-wave IEC18004\nClassifier: Development Status :: 5 - Production/Stable\nClassifier: License :: OSI Approved :: BSD License\nClassifier: Operating System :: OS Independent\nClassifier: Intended Audience :: Developers\nClassifier: Programming Language :: Python\nClassifier: Programming Language :: Python :: 3\nClassifier: Programming Language :: Python :: 3.6\nClassifier: Programming Language :: Python :: 3.7\nClassifier: Programming Language :: Python :: 3.8\nClassifier: Programming Language :: Python :: 3.9\nClassifier: Programming Language :: Python :: 3.10\nClassifier: Programming Language :: Python :: 3 :: Only\nClassifier: Topic :: Multimedia :: Graphics\nClassifier: Topic :: Software Development :: Libraries :: Python Modules\nRequires-Python: >=3.6\nLicense-File: LICENSE\nRequires-Dist: colorama ; platform_system == "Windows"\nProvides-Extra: all\nRequires-Dist: zest.releaser[recommended] ; extra == \'all\'\nRequires-Dist: tox ; extra == \'all\'\nRequires-Dist: pytest ; extra == \'all\'\nRequires-Dist: pytest-cov ; extra == \'all\'\nRequires-Dist: pillow ; extra == \'all\'\nProvides-Extra: dev\nRequires-Dist: tox ; extra == \'dev\'\nRequires-Dist: pytest ; extra == \'dev\'\nProvides-Extra: maintainer\nRequires-Dist: zest.releaser[recommended] ; extra == \'maintainer\'\nProvides-Extra: pil\nRequires-Dist: pillow ; extra == \'pil\'\nProvides-Extra: test\nRequires-Dist: pytest ; extra == \'test\'\nRequires-Dist: pytest-cov ; extra == \'test\'\n\n=============================\nPure python QR Code generator\n=============================\n\nGenerate QR codes.\n\nFor a standard install (which will include pillow_ for generating images),\nrun::\n\n    pip install qrcode[pil]\n\n.. _pillow: https://pypi.python.org/pypi/Pillow\n\n\nWhat is a QR Code?\n==================\n\nA Quick Response code is a two-dimensional pictographic code used for its fast\nreadability and comparatively large storage capacity. The code consists of\nblack modules arranged in a square pattern on a white background. The\ninformation encoded can be made up of any kind of data (e.g., binary,\nalphanumeric, or Kanji symbols)\n\nUsage\n=====\n\nFrom the command line, use the installed ``qr`` script::\n\n    qr "Some text" > test.png\n\nOr in Python, use the ``make`` shortcut function:\n\n.. code:: python\n\n    import qrcode\n    img = qrcode.make(\'Some data here\')\n    type(img)  # qrcode.image.pil.PilImage\n    img.save("some_file.png")\n\nAdvanced Usage\n--------------\n\nFor more control, use the ``QRCode`` class. For example:\n\n.. code:: python\n\n    import qrcode\n    qr = qrcode.QRCode(\n        version=1,\n        error_correction=qrcode.constants.ERROR_CORRECT_L,\n        box_size=10,\n        border=4,\n    )\n    qr.add_data(\'Some data\')\n    qr.make(fit=True)\n\n    img = qr.make_image(fill_color="black", back_color="white")\n\nThe ``version`` parameter is an integer from 1 to 40 that controls the size of\nthe QR Code (the smallest, version 1, is a 21x21 matrix).\nSet to ``None`` and use the ``fit`` parameter when making the code to determine\nthis automatically.\n\n``fill_color`` and ``back_color`` can change the background and the painting\ncolor of the QR, when using the default image factory. Both parameters accept\nRGB color tuples.\n\n.. code:: python\n\n\n    img = qr.make_image(back_color=(255, 195, 235), fill_color=(55, 95, 35))\n\nThe ``error_correction`` parameter controls the error correction used for the\nQR Code. The following four constants are made available on the ``qrcode``\npackage:\n\n``ERROR_CORRECT_L``\n    About 7% or less errors can be corrected.\n``ERROR_CORRECT_M`` (default)\n    About 15% or less errors can be corrected.\n``ERROR_CORRECT_Q``\n    About 25% or less errors can be corrected.\n``ERROR_CORRECT_H``.\n    About 30% or less errors can be corrected.\n\nThe ``box_size`` parameter controls how many pixels each "box" of the QR code\nis.\n\nThe ``border`` parameter controls how many boxes thick the border should be\n(the default is 4, which is the minimum according to the specs).\n\nOther image factories\n=====================\n\nYou can encode as SVG, or use a new pure Python image processor to encode to\nPNG images.\n\nThe Python examples below use the ``make`` shortcut. The same ``image_factory``\nkeyword argument is a valid option for the ``QRCode`` class for more advanced\nusage.\n\nSVG\n---\n\nYou can create the entire SVG or an SVG fragment. When building an entire SVG\nimage, you can use the factory that combines as a path (recommended, and\ndefault for the script) or a factory that creates a simple set of rectangles.\n\nFrom your command line::\n\n    qr --factory=svg-path "Some text" > test.svg\n    qr --factory=svg "Some text" > test.svg\n    qr --factory=svg-fragment "Some text" > test.svg\n\nOr in Python:\n\n.. code:: python\n\n    import qrcode\n    import qrcode.image.svg\n\n    if method == \'basic\':\n        # Simple factory, just a set of rects.\n        factory = qrcode.image.svg.SvgImage\n    elif method == \'fragment\':\n        # Fragment factory (also just a set of rects)\n        factory = qrcode.image.svg.SvgFragmentImage\n    else:\n        # Combined path factory, fixes white space that may occur when zooming\n        factory = qrcode.image.svg.SvgPathImage\n\n    img = qrcode.make(\'Some data here\', image_factory=factory)\n\nTwo other related factories are available that work the same, but also fill the\nbackground of the SVG with white::\n\n    qrcode.image.svg.SvgFillImage\n    qrcode.image.svg.SvgPathFillImage\n\n\nPure Python PNG\n---------------\n\nInstall the following two packages::\n\n    pip install -e git+git://github.com/ojii/pymaging.git#egg=pymaging\n    pip install -e git+git://github.com/ojii/pymaging-png.git#egg=pymaging-png\n\nFrom your command line::\n\n    qr --factory=pymaging "Some text" > test.png\n\nOr in Python:\n\n.. code:: python\n\n    import qrcode\n    from qrcode.image.pure import PymagingImage\n    img = qrcode.make(\'Some data here\', image_factory=PymagingImage)\n\n\nStyled Image\n------------\nTo apply styles to the QRCode, use the StyledPilImage image factory. \nThis takes an optional module drawer to control the shape of the QR Code, an \noptional color mask to change the colors of the QR Code, and an optional image \nto embed in the center.\n\nThese QR Codes are not guaranteed to work with all readers, so do some \nexperimentation and set the error correction to high (especially if embedding an \nimage).\n\nExamples to draw the QR code with rounded corners, radial gradiant and embedded image:\n\n.. code:: python\n\n    import qrcode\n    from qrcode.image.styledpil import StyledPilImage\n    from qrcode.image.styles.moduledrawers import RoundedModuleDrawer\n    from qrcode.image.styles.colormasks import RadialGradiantColorMask\n\n    qr = qrcode.QRCode(error_correction=qrcode.constants.ERROR_CORRECT_L)\n    qr.add_data(\'Some data\')\n\n    img_1 = qr.make_image(image_factory=StyledPilImage, module_drawer=RoundedModuleDrawer())\n    img_2 = qr.make_image(image_factory=StyledPilImage, color_mask=RadialGradiantColorMask())\n    img_3 = qr.make_image(image_factory=StyledPilImage, embeded_image_path="/path/to/image.png")\n\nOther module_drawers:\n\n    .. image:: doc/module_drawers.png\n\nOther color masks:\n\n    .. image:: doc/color_masks.png\n\nExamples\n========\n\nGet the text content from `print_ascii`:\n\n.. code:: python\n\n    import io\n    import qrcode\n    qr = qrcode.QRCode()\n    qr.add_data("Some text")\n    f = io.StringIO()\n    qr.print_ascii(out=f)\n    f.seek(0)\n    print(f.read())\n\nThe `add_data` method will append data to the current QR object. To add new data by replacing previous content in the same object, first use clear method:\n\n.. code:: python\n\n    import qrcode\n    qr = qrcode.QRCode()\n    qr.add_data(\'Some data\')\n    img = qr.make_image()\n    qr.clear()\n    qr.add_data(\'New data\')\n    other_img = qr.make_image()\n\nPipe ascii output to text file in command line::\n\n    qr --ascii "Some data" > "test.txt"\n    cat test.txt\n\nAlternative to piping output to file to avoid PoweShell issues::\n\n    # qr "Some data" > test.png\n    qr --output=test.png "Some data"\n\n==========\nChange log\n==========\n\n7.3.1 (1 October 2021)\n======================\n\n- Improvements for embeded image.\n\n\n7.3 (19 August 2021)\n====================\n\n- Skip color mask if QR is black and white\n\n\n7.2 (19 July 2021)\n==================\n\n- Add Styled PIL image factory, allowing different color masks and shapes in QR codes\n\n- Small performance inprovement\n\n- Add check for border size parameter\n\n\n7.1 (1 July 2021)\n=================\n\n- Add --ascii parameter to command line interface allowing to output ascii when stdout is piped\n\n- Add --output parameter to command line interface to specify output file\n\n- Accept RGB tuples in fill_color and back_color\n\n- Add to_string method to SVG images\n\n- Replace inline styles with SVG attributes to avoid CSP issues\n\n- Add Python3.10 to supported versions\n\n\n7.0 (29 June 2021)\n==================\n\n- Drop Python < 3.6 support.\n\n\n6.1 (14 January 2019)\n=====================\n\n- Fix short chunks of data not being optimized to the correct mode.\n\n- Tests fixed for Python 3\n\n\n6.0 (23 March 2018)\n===================\n\n- Fix optimize length being ignored in ``QRCode.add_data``.\n\n- Better calculation of the best mask pattern and related optimizations. Big\n  thanks to cryptogun!\n\n\n5.3 (18 May 2016)\n=================\n\n* Fix incomplete block table for QR version 15. Thanks Rodrigo Queiro for the\n  report and Jacob Welsh for the investigation and fix.\n\n* Avoid unnecessary dependency for non MS platforms, thanks to Noah Vesely.\n\n* Make ``BaseImage.get_image()`` actually work.\n\n\n5.2 (25 Jan 2016)\n=================\n\n* Add ``--error-correction`` option to qr script.\n\n* Fix script piping to stdout in Python 3 and reading non-UTF-8 characters in\n  Python 3.\n\n* Fix script piping in Windows.\n\n* Add some useful behind-the-curtain methods for tinkerers.\n\n* Fix terminal output when using Python 2.6\n\n* Fix terminal output to display correctly on MS command line.\n\n5.2.1\n-----\n\n* Small fix to terminal output in Python 3 (and fix tests)\n\n5.2.2\n-----\n\n* Revert some terminal changes from 5.2 that broke Python 3\'s real life tty\n  code generation and introduce a better way from Jacob Welsh.\n\n\n5.1 (22 Oct 2014)\n=================\n\n* Make ``qr`` script work in Windows. Thanks Ionel Cristian Mărieș\n\n* Fixed print_ascii function in Python 3.\n\n* Out-of-bounds code version numbers are handled more consistently with a\n  ValueError.\n\n* Much better test coverage (now only officially supporting Python 2.6+)\n\n\n5.0 (17 Jun 2014)\n=================\n\n* Speed optimizations.\n\n* Change the output when using the ``qr`` script to use ASCII rather than\n  just colors, better using the terminal real estate.\n\n* Fix a bug in passing bytecode data directly when in Python 3.\n\n* Substation speed optimizations to best-fit algorithm (thanks Jacob Welsh!).\n\n* Introduce a ``print_ascii`` method and use it as the default for the ``qr``\n  script rather than ``print_tty``.\n\n5.0.1\n-----\n\n* Update version numbers correctly.\n\n\n4.0 (4 Sep 2013)\n================\n\n* Made qrcode work on Python 2.4 - Thanks tcely.\n  Note: officially, qrcode only supports 2.5+.\n\n* Support pure-python PNG generation (via pymaging) for Python 2.6+ -- thanks\n  Adam Wisniewski!\n\n* SVG image generation now supports alternate sizing (the default box size of\n  10 == 1mm per rectangle).\n\n* SVG path image generation allows cleaner SVG output by combining all QR rects\n  into a single path. Thank you, Viktor Stískala.\n\n* Added some extra simple SVG factories that fill the background white.\n\n4.0.1\n-----\n\n* Fix the pymaging backend not able to save the image to a buffer. Thanks ilj!\n\n4.0.2\n-----\n\n* Fix incorrect regex causing a comma to be considered part of the alphanumeric\n  set.\n\n* Switch to using setuptools for setup.py.\n\n4.0.3\n-----\n\n* Fix bad QR code generation due to the regex comma fix in version 4.0.2.\n\n4.0.4\n-----\n\n* Bad version number for previous hotfix release.\n\n\n3.1 (12 Aug 2013)\n=================\n\n* Important fixes for incorrect matches of the alpha-numeric encoding mode.\n  Previously, the pattern would match if a single line was alpha-numeric only\n  (even if others wern\'t). Also, the two characters ``{`` and ``}`` had snuck\n  in as valid characters. Thanks to Eran Tromer for the report and fix.\n\n* Optimized chunking -- if the parts of the data stream can be encoded more\n  efficiently, the data will be split into chunks of the most efficient modes.\n\n3.1.1\n-----\n\n* Update change log to contain version 3.1 changes. :P\n\n* Give the ``qr`` script an ``--optimize`` argument to control the chunk\n  optimization setting.\n\n\n3.0 (25 Jun 2013)\n=================\n\n* Python 3 support.\n\n* Add QRCode.get_matrix, an easy way to get the matrix array of a QR code\n  including the border. Thanks Hugh Rawlinson.\n\n* Add in a workaround so that Python 2.6 users can use SVG generation (they\n  must install ``lxml``).\n\n* Some initial tests! And tox support (``pip install tox``) for testing across\n  Python platforms.\n\n\n2.7 (5 Mar 2013)\n================\n\n* Fix incorrect termination padding.\n\n\n2.6 (2 Apr 2013)\n================\n\n* Fix the first four columns incorrectly shifted by one. Thanks to Josep\n  Gómez-Suay for the report and fix.\n\n* Fix strings within 4 bits of the QR version limit being incorrectly\n  terminated. Thanks to zhjie231 for the report.\n\n\n2.5 (12 Mar 2013)\n=================\n\n* The PilImage wrapper is more transparent - you can use any methods or\n  attributes available to the underlying PIL Image instance.\n\n* Fixed the first column of the QR Code coming up empty! Thanks to BecoKo.\n\n2.5.1\n-----\n\n* Fix installation error on Windows.\n\n\n2.4 (23 Apr 2012)\n=================\n\n* Use a pluggable backend system for generating images, thanks to Branko Čibej!\n  Comes with PIL and SVG backends built in.\n\n2.4.1\n-----\n\n* Fix a packaging issue\n\n2.4.2\n-----\n\n* Added a ``show`` method to the PIL image wrapper so the ``run_example``\n  function actually works.\n\n\n2.3 (29 Jan 2012)\n=================\n\n* When adding data, auto-select the more efficient encoding methods for numbers\n  and alphanumeric data (KANJI still not supported).\n\n2.3.1\n-----\n\n* Encode unicode to utf-8 bytestrings when adding data to a QRCode.\n\n\n2.2 (18 Jan 2012)\n=================\n\n* Fixed tty output to work on both white and black backgrounds.\n\n* Added `border` parameter to allow customizing of the number of boxes used to\n  create the border of the QR code\n\n\n2.1 (17 Jan 2012)\n=================\n\n* Added a ``qr`` script which can be used to output a qr code to the tty using\n  background colors, or to a file via a pipe.\n', 'context': None}
    qr.add_data(data)
    qr.make(fit=True)
    img_io = BytesIO()
    if format.upper() == "SVG":
        img = qr.make_image(
            fill_color=color,
            back_color="white",
            image_factory=qrcode.image.svg.SvgImage,
        )  # TODO(autogpt): "svg" is not a known member of module "qrcode.image". reportAttributeAccessIssue
    else:
        img = qr.make_image(fill_color=color, back_color="white")
    img.save(img_io)
    img_data = img_io.getvalue()
    qr_code_data = b64encode(img_data).decode("utf-8")
    qr_code_url = f"data:image/{format.lower()};base64,{qr_code_data}"
    return CreateQRCodeResponse(qr_code_url=qr_code_url, qr_code_data=qr_code_data)
